(function(){window.debug=console.debug.bind(console),window.log=console.log.bind(console),window.warn=console.warn.bind(console),window.Reader={Models:{},Collections:{},Views:{},Routers:{},flash_message:function(e){var t;return t=$("<div class='flash'><span class='alert alert-success'>"+e+"</span></div>"),t.appendTo($("body")),setTimeout(function(){return t.fadeOut(400,function(){return $(this).remove()})},2e3)},update_unread:function(e,t){var n;return null!=(n=Reader.categories.find_feed(e))?n.trigger("update_unread",t):void 0},initialize:function(){var e;return e=Reader,e.categories=new Reader.Collections.Categories,e.unread_entries=new Reader.Collections.UnreadEntries,e.starred_entries=new Reader.Collections.StarredEntries,e.menu_manager=new Reader.Views.MenuManager,e.display_manager=new Reader.Views.DisplayManager,e.router=new Reader.Routers.Main}},$(document).ready(function(){return Reader.initialize()})}).call(this),function(){this.JST||(this.JST={}),this.JST.entries=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="head dropdown">\n    <i class="glyphicon glyphicon-th menu_toggle "></i><span class="brand"><span class="title">'),n.push(r(this.title)),n.push('</span><b class="caret"></b></span>\n    <ul class="dropdown-menu" role="menu">\n        '),this.entries instanceof Reader.Collections.UnreadEntries||this.entries instanceof Reader.Collections.StarredEntries||n.push('\n            <li role="presentation" class="dropdown-header">Mark as read</li>\n            <li><a href="#" data-mark="all">All</a></li>\n            <li><a href="#" data-mark="1day">Older than 1 day</a></li>\n            <li><a href="#" data-mark="1week">Older than 1 week</a></li>\n            <li class="divider"></li>\n            <li><a href="#" class="edit_style">Edit Feed Style</a></li>\n            <li class="divider"></li>\n            <li><a href="#" class="delete"><span class="glyphicon glyphicon-remove"></span>Delete Feed</a></li>\n        '),n.push('\n        <li><a href="#" class="refresh"><span class="glyphicon glyphicon-refresh"></span>Fetch Latest</a></li>\n    </ul>\n</div>\n<ul class="entries body">\n    Loading...\n</ul>\n')}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/article"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push("<h2>"),n.push(r(this.entry.get("title"))),n.push("</h2>\n<h4>"),n.push(r(this.entry.get("author"))),n.push('</h4>\n\n<span class="close"><i class="glyphicon glyphicon-minus"></i> </span>\n'),this.entry.has("content")&&""!==this.entry.get("content")?(n.push("\n"),n.push(this.entry.get("content")),n.push("\n")):(n.push("\n"),n.push(this.entry.get("summary")),n.push("\n")),n.push("\n")}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/category"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div>\n    <i class="glyphicon glyphicon-chevron-down"></i>\n    <i class="glyphicon glyphicon-chevron-right"></i>\n    <span class="cat_name">'),n.push(r(this.model.get("name"))),n.push('</span>\n</div>\n<ul class="feeds">\n</ul>\n')}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/editor"]=function(e){e||(e={});var t,n=[],r=e.safe,o=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<pre id="editor"></pre>\n<div class="controls">\n    <button class="btn btn-primary">Save</button>\n    <button class="btn">Close</button>\n</div>\n<script type="text/template" id="template">// sample scss, all styles here will not affect other feed\n//#style_editor {\n//  margin: 0;\n//  position: fixed;\n//  padding: 0;\n//  top: 0;\n//  bottom: 0;\n//  left: 0;\n//  right: 0;\n//\n//  #editor {\n//    margin: 0;\n//    padding: 0;\n//    width: 100%;\n//    height: 100%;\n//  }\n//\n//  .controls {\n//    position: fixed;\n//    bottom: 10px;\n//    display: inline;\n//    right: 10px;\n//  }\n//}\n//\n\n</script>\n')}).call(this)}.call(e),e.safe=r,e.escape=o,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/entry"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="title">\n    '),n.push(r(this.entry.get("title"))),n.push('\n    <div class="sub_title">\n        '),null!=this.entry.get("author")&&(n.push("\n            "),n.push(r(this.entry.get("author"))),n.push("\n        ")),n.push("\n        "),null!=this.entry.get("entry_title")&&(n.push("\n            | "),n.push(r(this.entry.get("entry_title"))),n.push("\n        ")),n.push("\n\n        "),null!=this.entry.get("published")?(n.push('\n            <abbr class="timeago pull-right" title="'),n.push(r(this.entry.get("published"))),n.push('"></abbr>\n        ')):(n.push('\n            <abbr class="timeago pull-right" title="'),n.push(r(this.entry.get("created_at"))),n.push('"></abbr>\n        ')),n.push('\n        <div class="clearfix"></div>\n    </div>\n</div>\n<div class="detail">\n</div>\n')}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/entry_detail"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e;n.push('<div class="ops">\n    <a href="'),n.push(r(this.entry.get("url"))),n.push('" target=_blank class="glyphicon glyphicon-link"></a>\n    <i class="glyphicon glyphicon-star star"></i>\n    <i class="glyphicon glyphicon-minus close pull-right"></i>\n</div>\n<h3>\n    <a href="'),n.push(r(this.entry.get("url"))),n.push('" target=_blank>'),n.push(r(this.entry.get("title"))),n.push("</a>\n</h3>\n<h5>\n    "),e=[],n.push("\n    "),null!=this.entry.get("author")&&(n.push("\n        "),e.push(this.entry.get("author")),n.push("\n    ")),n.push("\n\n    "),null!=this.entry.get("published")?(n.push("\n        "),e.push(strftime("%d %b %Y",new Date(this.entry.get("published")))),n.push("\n    ")):null!=this.entry.get("created_at")&&(n.push("\n        "),e.push(strftime("%d %b %Y",new Date(this.entry.get("created_at")))),n.push("\n    ")),n.push("\n    - "),n.push(r(e.join(" / "))),n.push('\n</h5>\n<div class="article_body" data-feed-id="'),n.push(r(this.entry.get("feed_id"))),n.push('">\n    '),this.entry.has("content")&&""!==this.entry.get("content")?(n.push("\n    "),n.push(this.entry.get("content")),n.push("\n    ")):(n.push("\n    "),n.push(this.entry.get("summary")),n.push("\n    ")),n.push("\n</div>\n")}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["feeds/feed"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<a href="#feeds/'),n.push(r(this.feed.get("category_id"))),n.push("/"),n.push(r(this.feed.get("id"))),n.push('">\n'),n.push(r(this.feed.get("title"))),n.push(' <span class="unread pull-right">'),n.push(r(this.feed.get("unread_count"))),n.push('</span>\n</a>\n<!--<div class="desc">'),n.push(r(this.feed.get("description"))),n.push("</div>-->\n")}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["popups/new_feed"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,t,o,i;for(n.push('<div>\n    <div class="form-group ">\n        <label for="feed_source">Feed Source: </label>\n        <input type="text" name="feed_source" class="form-control"/>\n    </div>\n    <div class="form-group">\n        <label for="feed_category">Category: </label>\n        <select name="feed_category" class="form-control">\n            '),i=Reader.categories.models,t=0,o=i.length;o>t;t++)e=i[t],n.push('\n                <option value="'),n.push(r(e.get("id"))),n.push('">'),n.push(r(e.get("name"))),n.push("</option>\n            ");n.push('\n        </select>\n    </div>\n    <div class="form-group form-inline">\n        <button class="btn new btn-primary" data-loading-text="fetching feed..">Submit</button>\n        <button class="btn cancel">cancel</button>\n    </div>\n</div>\n')}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["popups/settings/_categories"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,t,o,i;for(n.push('<div class="form-inline">\n    <div class="form-group">\n        <label for="">New Group</label>\n        <input type="text" class="form-control"/>\n        <button class="add btn btn-primary">Add</button>\n    </div>\n</div>\n<ol class="categories">\n    '),i=this.cats.models,t=0,o=i.length;o>t;t++)e=i[t],n.push('\n    <li data-id="'),n.push(r(e.id)),n.push('"><span>'),n.push(r(e.get("name"))),n.push('</span>\n        <i class="pull-right glyphicon glyphicon-edit edit"></i>\n        <i class="pull-right glyphicon glyphicon-remove delete"></i>\n        <label class="pull-right label label-default">'),n.push(r(e.feeds.length)),n.push(" feeds</label>\n    </li>\n    ");n.push("\n</ol>\n")}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["popups/settings/_feeds"]=function(e){e||(e={});var t,n=[],r=function(e){return e&&e.ecoSafe?e:"undefined"!=typeof e&&null!=e?i(e):""},o=e.safe,i=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},i||(i=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,t,o,i;for(n.push('<div class="tab-pane active" id="settings_feeds">\n    <ol class="feeds">\n        '),i=this.feeds,t=0,o=i.length;o>t;t++)e=i[t],n.push('\n        <li data-id="'),n.push(r(e.id)),n.push('"><span>'),n.push(r(e.get("title"))),n.push('</span>\n            <i class="pull-right glyphicon glyphicon-edit edit"></i>\n            <i class="pull-right glyphicon glyphicon-remove delete"></i>\n        </li>\n        ');n.push("\n    </ol>\n</div>\n")}).call(this)}.call(e),e.safe=o,e.escape=i,n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["popups/settings/settings"]=function(e){e||(e={});var t,n=[],r=e.safe,o=e.escape;return t=e.safe=function(e){if(e&&e.ecoSafe)return e;("undefined"==typeof e||null==e)&&(e="");var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div>\n    <ul class="nav nav-tabs">\n        <li class="active"><a href="#settings_categories" data-toggle="tab">Manage Categories</a></li>\n        <li><a href="#settings_feeds" data-toggle="tab">Manage Feeds</a></li>\n    </ul>\n    <div class="tab-content">\n        loading...\n    </div>\n    <i class="glyphicon glyphicon-remove-circle close"></i>\n</div>\n\n')}).call(this)}.call(e),e.safe=r,e.escape=o,n.join("")}}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Models.Category=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.initialize=function(){return this.feeds_are_loaded=$.Deferred()},r.prototype.parse=function(e){var t=this;return this.feeds=new Reader.Collections.Feeds,this.feeds.url="/categories/"+e.id+"/feeds",this.feeds.once("reset",function(){return t.feeds_are_loaded.resolve()}),e},r.prototype.load_feeds=function(){return"resolved"!==this.feeds_are_loaded.state()?(log("loading feeds for category: "+this.get("name")),this.feeds.fetch({reset:!0})):void 0},r}(Backbone.Model)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Models.Entry=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r}(Backbone.Model)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Models.Feed=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.urlRoot="/feeds",r}(Backbone.Model)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Collections.Categories=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.url="/categories",r.prototype.model=Reader.Models.Category,r.prototype.find_feed=function(e){var t,n,r,o,i;for(i=this.models,r=0,o=i.length;o>r;r++)if(t=i[r],n=t.feeds.get(e),null!=n)return n},r.prototype.initialize=function(){return this.all_feeds_are_loaded=$.Deferred(),this.on("destroy",this.move_feeds)},r.prototype.move_feeds=function(e){var t;return t=this.where({name:"Default"},!0),null!=t?e.feeds.each(function(e){return e.set("category_id",t.id),t.feeds.add(e)}):void 0},r.prototype.load_all_feed=function(){var e,t=this;return e=this.map(function(e){return e.load_feeds(),e.feeds_are_loaded}),$.when.apply($,e).done(function(){return t.all_feeds_are_loaded.resolve()}),this.all_feeds_are_loaded},r}(Backbone.Collection)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Collections.Entries=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.model=Reader.Models.Entry,r.prototype.refresh=function(){var e,t=this;return e=$.get(this.url+"/refresh"),e.done(function(e){return t.set(e,{remove:!1}),t.trigger("refreshed")})},r.prototype.comparator=function(e,t){return null!=e.get("published")&&null!=t.get("published")?e.get("published")>t.get("published")?-1:1:e.get("created_at")>t.get("created_at")?-1:1},r.prototype.mark_read=function(e){var t,n,r,o,i=this;switch(t=this.url.slice(0,-"entries".length-1)+"/mark_read",e){case"all":n=$.post(t);break;case"1day":n=$.post(t,{age:"1day"});break;case"1week":n=$.post(t,{age:"1week"})}return o=function(e){_.each(e,function(e){var t;return t=i.get(e),null!=t?t.set({is_read:1}):void 0})},r=function(e){var t;return t=_.difference(e,i.pluck("id")).length,log("update_feed_unread_count "+t),null!=i.feed?Reader.update_unread(i.feed.id,-t):void 0},n.done(o,r)},r.prototype.destroy=function(){return null!=this.feed?this.feed.destroy():void 0},r}(Backbone.Collection)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Collections.Feeds=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.url="/feeds",r.prototype.model=Reader.Models.Feed,r}(Backbone.Collection)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Collections.StarredEntries=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.url="/entries/starred",r}(Reader.Collections.Entries)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Collections.UnreadEntries=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.url="/entries/unread",r}(Reader.Collections.Entries)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.DisplayManager=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.el="div.content_col",r.prototype.initialize=function(){return this.unread_view=null,this.starred_view=null,this.feeds_view={},this.current_view=null},r.prototype.render_entries=function(e){var t,n;return this.source=e,null!=(n=this.current_view)&&n.$el.hide(),log("current view is :",this.current_view),this.source instanceof Reader.Collections.UnreadEntries?this.current_view=null!=this.unread_view?this.unread_view:this.unread_view=new Reader.Views.Entries({collection:this.source,title:"Unread"}):this.source instanceof Reader.Collections.StarredEntries?this.current_view=null!=this.starred_view?this.starred_view:this.starred_view=new Reader.Views.Entries({collection:this.source,title:"Starred"}):this.source instanceof Reader.Models.Feed&&(null==(t=this.source).entries&&(t.entries=new Reader.Collections.Entries),this.source.entries.feed=this.source,this.source.entries.url=this.source.url()+"/entries",null==this.feeds_view["feed_"+this.source.id]&&(this.feeds_view["feed_"+this.source.id]=new Reader.Views.Entries({collection:this.source.entries,title:this.source.get("title")})),this.current_view=this.feeds_view["feed_"+this.source.id]),$.contains(this.el,this.current_view.el)||(this.$el.append(this.current_view.render().el),this.current_view.load()),log("after change view: ",this.current_view),this.current_view.$el.show(),$(window).resize()},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Article=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.template=JST["feeds/article"],r.prototype.tagName="div",r.prototype.className="article",r.prototype.events={"click .close":"close"},r.prototype.close=function(){return this.hide()},r.prototype.render=function(){return this.$el.html(this.template({entry:this.model})),this.show(),this},r.prototype.show=function(){return $(".article.show").removeClass("show"),this.$el.addClass("show")},r.prototype.hide=function(){return this.$el.removeClass("show")},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Categories=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.el="#categories",r.prototype.initialize=function(){return this.cat_views={},this.listenTo(Reader.categories,"reset",this.render_cats),this.listenTo(Reader.categories,"add",this.render_cat)},r.prototype.render_cats=function(e){return e.each(this.render_cat.bind(this))},r.prototype.render_cat=function(e){var t;return t=new Reader.Views.Category({model:e}),this.$el.append(t.render().el),this.cat_views["cat_"+e.id]=t},r.prototype.open_feed=function(e,t){var n;return n=this.cat_views["cat_"+e],n.open(),n.rendered.done(function(){return $(".feed[data-id="+t+"] a").length>0?$(".feed[data-id="+t+"] a").click():Backbone.history.navigate("",{trigger:!0})})},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Category=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.template=JST["feeds/category"],r.prototype.tagName="li",r.prototype.className="category",r.prototype.initialize=function(){return this.$el.html(this.template({model:this.model})),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:name",this.update_name),this.listenTo(this.model.feeds,"add",this.add_feed),this.listenTo(this.model.feeds,"reset",this.add_feeds),this.$(".feeds").hide(),this.rendered=$.Deferred()},r.prototype.events={"click >div":"toggle",dragover:"dragover",dragleave:"dragleave",drop:"dropped"},r.prototype.update_name=function(){return this.$(".cat_name").text(this.model.get("name"))},r.prototype.dropped=function(e){var t,n,r;return n=JSON.parse(e.originalEvent.dataTransfer.getData("application/json")),t=Reader.categories.get(n.category_id),null==t?!1:(r=t.feeds.get(n.feed_id),null==r?!1:(t.feeds.remove(r),r.save("category_id",this.model.id),this.model.feeds.add(r),this.$el.removeClass("over"),this.open()))},r.prototype.dragleave=function(){return this.$el.removeClass("over")},r.prototype.dragover=function(){return this.$el.addClass("over"),!1},r.prototype.toggle=function(){return this.$el.is(".open")?(this.$el.removeClass("open"),this.$(".feeds").hide()):this.open()},r.prototype.open=function(){var e=this;if(!this.$el.hasClass("open"))return this.$el.addClass("open"),"resolved"!==this.model.feeds_are_loaded.state()&&this.model.load_feeds(),this.model.feeds_are_loaded.done(function(){return e.$(".feeds").show()})},r.prototype.add_feeds=function(e){return this.$(".feeds").empty(),e.each(this.add_feed,this),this.rendered.resolve()},r.prototype.add_feed=function(e){return this.$(".feeds").append(new Reader.Views.Feed({model:e}).render().el)},r.prototype.render=function(){return this},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Entries=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="div",r.prototype.className="content",r.prototype.template=JST.entries,r.prototype.initialize=function(e){var t=this;return this.title=e.title,this.$el.html(this.template({title:this.title,entries:this.collection})),this.id=this.title.toString().replace(/\s/g,"_"),this.$el.attr("id",this.id),this.listenTo(this.collection,"reset",this.render_entries),this.listenTo(this.collection,"add",this.render_entry),this.listenTo(this.collection,"remove",this.remove_entry),this.listenTo(this.collection,"refreshed",this.refreshed),null!=this.collection.feed&&(this.listenTo(this.collection.feed,"destroy",function(){return Reader.menu_manager.show_menu(),t.remove()}),this.listenTo(this.collection.feed,"change:title",function(){return t.$(".brand .title").text(t.collection.feed.get("title"))})),this.page=0,this.head=null,this.$("ul.entries").on("scroll",this.scroll.bind(this)),this.entry_views={}},r.prototype.render_entries=function(e){var t,n=this;return this.$(".loader").remove(),this.$("ul.entries").empty(),t=e.models,this.head=t[0],_.each(t,function(e){return n.render_entry(e)}),this.check_scroll()},r.prototype.events={"click .menu_toggle":"toggle_menu","click .brand":"toggle_feed_menu","click ul.dropdown-menu a[data-mark]":"mark_read","click ul.dropdown-menu a.refresh":"refresh_source","click ul.dropdown-menu a.delete":"delete_source","click ul.dropdown-menu a.edit_style":"edit_style"},r.prototype.close_menu=function(){return this.$(".head").removeClass("open")},r.prototype.edit_style=function(e){var t;return this.close_menu(),e.preventDefault(),null!=this.collection.feed?(null==Reader.style_editor&&(Reader.style_editor=new Reader.Views.StyleEditor),t=Reader.style_editor,t.show(this.collection.feed)):void 0},r.prototype.delete_source=function(){return this.collection.destroy(),!1},r.prototype.mark_read=function(e){var t;return this.close_menu(),t=$(e.target).data("mark"),this.collection.mark_read(t),!1},r.prototype.refresh_source=function(){return this.$(".head").removeClass("open"),this.collection.refresh(),!1},r.prototype.toggle_feed_menu=function(){return this.$(".head").toggleClass("open")},r.prototype.toggle_menu=function(){return $("body>.container").toggleClass("show_menu")},r.prototype.scroll=function(){var e=this;return log("scroll event"),null!=this.scroll_detector&&clearTimeout(this.scroll_detector),this.scroll_detector=setTimeout(function(){return e.check_scroll()},500),!0},r.prototype.check_scroll=function(){var e,t,n,r,o=this;return log("check scroll, state is "+this.state),"nomore"!==this.state?(r=this.$("ul.entries"),n=r.scrollTop()+r.height(),e=r[0].scrollHeight,log("scroll_bottom: "+n+" actual_height: "+e+" state: "+this.state),4>e-n&&"loading"!==this.state?(warn("getting more entries"),this.state="loading",r.append("<li class='more'>loading more ...</li>"),this.page+=1,t=$.getJSON(this.collection.url+"?page="+this.page),t.done(function(e){return o.collection.add(e),o.state="loaded",o.$("li.more").remove()}),t.fail(function(e,t,n){return o.state="nomore","Not Found"===n?o.$("li.more").html("No more"):void 0})):void 0):void 0},r.prototype.refreshed=function(){return Reader.flash_message("feed is updated successfully! ")},r.prototype.refresh_feed=function(){return this.collection.refresh()},r.prototype.render_entry=function(e){var t,n,r,o;for(this.$("li.more").remove(),n=new Reader.Views.Entry({model:e,parent:this}),r=this.collection.indexOf(e)+1,o=null;r<this.collection.length;){if(t=this.collection.at(r),null!=this.entry_views["entry_"+t.id]){o=this.entry_views["entry_"+t.id];break}r+=1}return null!=o?(this.$(".entries").append(n.render().el),$(n.render().el).insertBefore(o.el)):this.$(".entries").append(n.render().el),this.entry_views["entry_"+e.id]=n},r.prototype.set_opened_entry=function(e){return this.opened_entry=e},r.prototype.remove_entry=function(e){var t;return null!=(t=this.entry_views["entry_"+e.id])?t.remove():void 0},r.prototype.render=function(){return this},r.prototype.load=function(){var e=this;return this.collection.fetch({reset:!0,error:function(){return e.$(".entries").html("No entries available")}})},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Entry=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.template=JST["feeds/entry"],r.prototype.template_detail=JST["feeds/entry_detail"],r.prototype.tagName="li",r.prototype.className="entry",r.prototype.initialize=function(e){return this.listenTo(this.model,"change:is_read",this.update_read_status),this.parent=e.parent,this.feed=Reader.categories.find_feed(this.model.get("feed_id")),null!=this.feed?this.listenTo(this.feed,"change:compiled_style",this.render_style):void 0},r.prototype.events={"click .title":"open","click .close":"close","click .star":"toggle_starred"},r.prototype.toggle_starred=function(){return this.model.urlRoot="/feeds/"+this.model.id+"/entries",1===this.model.get("is_starred")?(this.model.save({is_starred:0}),this.$el.removeClass("is_starred"),Reader.starred_entries.remove(this.model)):(this.model.save({is_starred:1}),this.$el.addClass("is_starred"),Reader.starred_entries.add(this.model))},r.prototype.update_read_status=function(){return this.model.urlRoot="/feeds/"+this.model.id+"/entries",this.model.get("is_read")?this.$el.addClass("is_read"):this.$el.removeClass("is_read"),0===this.model.previous("is_read")&&1===this.model.get("is_read")?Reader.update_unread(this.model.get("feed_id"),-1):void 0},r.prototype.close=function(e){return null==e||$(e.currentTarget).is(".close")?(this.$(".title").show(),this.$(".detail").hide()):void 0},r.prototype.render_style=function(){var e,t;return log("render style"),null!=this.feed?(t="style_for_feed_"+this.model.id,$("#"+t).length>0?$("#"+t).text(this.feed.get("compiled_style")):(e=$("<style id='"+t+"'></style>").text(this.feed.get("compiled_style")),$("head").append(e))):void 0},r.prototype.open=function(){var e,t;return null!=(t=this.parent.opened_entry)&&t.close(),this.render_style(),this.$(".detail").show(),this.$(".title").hide(),/\W/.test(this.$(".detail").html())&&(this.$(".detail").html(this.template_detail({entry:this.model})),this.$("pre code, .prettyprint").each(function(e,t){return hljs.highlightBlock(t)}),this.model.save({is_read:1},{patch:!0})),e=_.reduce(this.$el.prevAll(),function(e,t){return e+=$(t).outerHeight(!0)},0),this.$el.parent().scrollTop(e),this.parent.set_opened_entry(this)},r.prototype.render=function(){return this.$el.html(this.template({entry:this.model})),this.$(".timeago").timeago(),this.model.trigger("change:is_read"),1===this.model.get("is_starred")&&this.$el.addClass("is_starred"),this},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.Feed=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="li",r.prototype.className="list-unstyled feed",r.prototype.attributes={draggable:!0},r.prototype.template=JST["feeds/feed"],r.prototype.initialize=function(){return this.listenTo(this.model,"remove destroy",this.remove_feed),this.listenTo(this.model,"update_unread",this.update_unread),this.listenTo(this.model,"change:title",this.render),this.$el.attr("data-id",this.model.id)},r.prototype.remove_feed=function(){return this.remove()},r.prototype.events={click:"open",dragstart:"dragstart",dragend:"dragend"},r.prototype.dragstart=function(e){var t;
return this.$el.css("opacity",.1),t={feed_id:this.model.id,category_id:this.model.get("category_id")},e.originalEvent.dataTransfer.setData("application/json",JSON.stringify(t))},r.prototype.dragend=function(){return this.$el.css("opacity",1)},r.prototype.open=function(){return log("called open feed"),this.show_entries(),$("li.feed.selected").removeClass("selected"),this.$el.addClass("selected")},r.prototype.render=function(){return this.$el.html(this.template({feed:this.model})),this},r.prototype.show_entries=function(){return Reader.display_manager.render_entries(this.model)},r.prototype.update_unread=function(e){return this.model.set("unread_count",Math.max(parseInt(this.model.get("unread_count"),10)+e,0)),this.$(".unread").text(this.model.get("unread_count"))},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.NewFeed=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.template=JST["popups/new_feed"],r.prototype.tagName="form",r.prototype.className="new_feed popup",r.prototype.attributes={role:"form"},r.prototype.events={"click .btn.new":"new_feed","click .btn.cancel":"close"},r.prototype.render=function(){return this.$el.html(this.template()),this},r.prototype.close=function(e){return null!=e&&e.preventDefault(),this.remove()},r.prototype.new_feed=function(e){var t,n,r=this;return this.$(".btn.new").button("loading"),e.preventDefault(),n=this.$("[name=feed_category]").val(),t=Reader.categories.get(n),t.feeds.create({feed_url:this.$("[name=feed_source]").val(),category_id:n},{wait:!0,success:function(){return r.close()},error:function(e,t){return r.error_add_feed(t.status)}})},r.prototype.error_add_feed=function(e){return 422===e?alert("already added"):404===e&&alert("feed is not found"),this.$(".btn.new").button("reset")},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.MenuManager=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.el="div.menu_col",r.prototype.initialize=function(){return this.cats_menu=new Reader.Views.Categories({collection:Reader.categories})},r.prototype.events={"click #menu .new_sub":"new_sub","click #menu .feed, .unread, .starred":"hide_menu","click .head .settings":"settings"},r.prototype.new_sub=function(e){var t;return e.preventDefault(),t=new Reader.Views.NewFeed,$("body").append(t.render().el),$("[name=feed_source]").focus()},r.prototype.show_menu=function(){return $("body>.container").addClass("show_menu")},r.prototype.hide_menu=function(){return $("body>.container").removeClass("show_menu")},r.prototype.settings=function(){return this.hide_menu(),Reader.settings=new Reader.Views.Settings,$.contains($("body"),Reader.settings.el)||$("body").append(Reader.settings.el),this.$(".dropdown").removeClass("open"),!1},r}(Backbone.View)}.call(this),function(){var e,t,n,r={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Reader.Views.SettingsCategories=function(t){function n(){return e=n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.tagName="div",n.prototype.className="tab-pane active",n.prototype.id="settings_categories",n.prototype.template=JST["popups/settings/_categories"],n.prototype.initialize=function(){return this.render(),this.listenTo(Reader.categories,"add",this.render),this.listenTo(Reader.categories,"destroy",this.render)},n.prototype.events={"click .add":"add_category","click .edit":"edit_category","click .delete":"delete_category"},n.prototype.edit_form="<div class='form-inline edit_name'>\n  <div class='form-group'>\n    <input type='text' class='form-control' placeholder='new name'/>\n    <button class='btn btn-primary save'>save</button>\n    <button class='btn cancel'>cancel</button>\n  </div>\n</div>",n.prototype.edit_category=function(e){var t,n;return n=this.$(e.target).closest("li"),t=Reader.categories.get(n.data("id")),n.find(".edit_name").length>0?void 0:(n.append(this.edit_form),n.find(".save").click(function(){return t.save({name:n.find("input").val()},{patch:!0,success:function(){return n.find("span").text(t.get("name"))}}),n.find(".edit_name").remove()}),n.find(".cancel").click(function(){return n.find(".edit_name").remove()}))},n.prototype.delete_category=function(e){var t,n;return n=$(e.target).parent().data("id"),t=Reader.categories.get(n),null!=t?(t.destroy(),Reader.flash_message("Feeds under "+t.get("name")+" are moved to Deafult")):void 0},n.prototype.add_category=function(){return Reader.categories.create({name:this.$("input").val()},{wait:!0})},n.prototype.render=function(){return this.$el.html(this.template({cats:Reader.categories})),this},n}(Backbone.View),Reader.Views.SettingsFeeds=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return o(n,e),n.prototype.tagName="div",n.prototype.className="tab-pane",n.prototype.id="settings_feeds",n.prototype.template=JST["popups/settings/_feeds"],n.prototype.initialize=function(){return this.render()},n.prototype.events={"click .edit":"edit_feed","click .delete":"delete_feed"},n.prototype.edit_form="<div class='form-inline edit_name'>\n  <div class='form-group'>\n    <input type='text' class='form-control' placeholder='new name'/>\n    <button class='btn btn-primary save'>save</button>\n    <button class='btn cancel'>cancel</button>\n  </div>\n</div>",n.prototype.edit_feed=function(e){var t,n,r;return n=$(e.target).closest("li"),r=n.data("id"),t=this.collection.get(r),n.find(".edit_name").length>0?void 0:(n.append(this.edit_form),n.find(".save").click(function(){return t.save({title:n.find("input").val()},{patch:!0,success:function(){return n.find("span").text(t.get("title"))}}),n.find(".edit_name").remove()}),n.find(".cancel").click(function(){return n.find(".edit_name").remove()}))},n.prototype.delete_feed=function(e){var t,n,r;return n=$(e.target).closest("li"),r=n.data("id"),t=this.collection.get(r),null!=t?(t.destroy({wait:!0,success:function(){return n.remove()}}),Reader.flash_message("Feed "+t.get("title")+" is removed")):void 0},n.prototype.render=function(){return this.$el.html(this.template({feeds:this.collection.models})),this},n}(Backbone.View),Reader.Views.Settings=function(e){function t(){return n=t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.tagName="div",t.prototype.id="settings",t.prototype.template=JST["popups/settings/settings"],t.prototype.events={"click .nav-tabs a":"toggle_tabs","click .close":"close",click:"close"},t.prototype.close=function(e){return e.target===e.currentTarget?this.remove():void 0},t.prototype.initialize=function(){var e=this;return this.$el.html(this.template()),this.feeds=[],Reader.categories.load_all_feed().done(function(){return Reader.categories.each(function(t){var n;return n=t.feeds.models,e.feeds=e.feeds.concat(n)}),e.render()})},t.prototype.toggle_tabs=function(e){return $(e.target).tab("show")},t.prototype.render=function(){var e,t;return this.$(".tab-content").empty(),e=new Reader.Views.SettingsCategories,this.$(".tab-content").append(e.el),t=new Reader.Views.SettingsFeeds({collection:new Backbone.Collection(this.feeds)}),this.$(".tab-content").append(t.el),this},t}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Views.StyleEditor=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.id="style_editor",r.prototype.template=JST["feeds/editor"],r.prototype.initialize=function(){return this.render(),$("body").append(this.$el),this.editor=ace.edit("editor"),this.editor.setTheme("ace/theme/twilight"),this.editor.getSession().setMode("ace/mode/scss")},r.prototype.render=function(){return this.$el.html(this.template()),this.$el.hide(),this},r.prototype.events={"click .btn-primary":"save","click .btn":"close"},r.prototype.save=function(){var e;return e=this.editor.getValue(),this.feed.save({style:e},{patch:!0}),!1},r.prototype.close=function(){return this.$el.fadeOut()},r.prototype.show=function(e){return this.feed=e,null==this.feed.get("style")||this.feed.get("style").match(/(^$)|(^\W+$)/)?this.editor.setValue(this.$("#template").text()):this.editor.setValue(e.get("style")),this.$el.fadeIn()},r}(Backbone.View)}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Reader.Routers.Main=function(t){function r(){return e=r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.routes={"":"home","feeds/:cid/:id":"show_feed",unread:"show_unread",starred:"show_starred"},r.prototype.initialize=function(){var e,t;return t=function(){var e,t,n;return n=$(window).outerHeight(!0),t=$(".content:visible .head").outerHeight(!0),e=n-t,$(".content:visible .body").height(e),t=$(".menu_col .head").outerHeight(!0),e=n-t,$("#menu").height(e)},$(window).resize(function(){return t()}),e=function(){var e;return e=$.Deferred(),Reader.categories.fetch({reset:!0,parse:!0,success:function(){return e.resolve()}}),e.promise()},$.when(e()).done(function(){return Backbone.history.start()})},r.prototype.show_feed=function(e,t){return Reader.menu_manager.cats_menu.open_feed(e,t)},r.prototype.show_unread=function(){return Reader.display_manager.render_entries(Reader.unread_entries)},r.prototype.show_starred=function(){return Reader.display_manager.render_entries(Reader.starred_entries)},r.prototype.home=function(){return this.show_unread()},r}(Backbone.Router)}.call(this),function(){}.call(this);